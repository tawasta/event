<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="website_event_track_agenda_editor.agenda" name="Event agenda editor" inherit_id="website_event_track_advanced.agenda">
        <xpath expr="//section[last()]" position="after">
            <t t-if="user.has_group('event.group_event_manager')">
                <t t-call="website_event_track_agenda_editor.agenda_editor"/>
            </t>
        </xpath>
    </template>

    <!--Agenda date content -->
    <template id="website_event_track_agenda_editor.agenda_editor">
        <div class="agenda-editor">
            <table id="agenda-editor-table"
                   class="agenda-editor-table table-responsive table table-bordered table-condensed">
                <tr>
                    <td class="event_track event-track-unassign text-muted">
                        <div class="row">
                            <div class="event-track-program-unassign col-xs-3">
                                <span class="fa fa-trash fa-2x track-program-unassign-icon"
                                      title="Remove from schedule"/>
                            </div>
                        </div>

                        <div class="row">
                            <div class="track-td-name col-xs-12">Drop here to remove from
                                schedule
                            </div>
                        </div>
                    </td>

                    <t t-foreach="unassigned_tracks" t-as="track">

                        <td class="event_track"
                            t-attf-name="track_#{track.id}"
                            draggable="true">
                            <div>
                                <div class="row">
                                    <div class="event-track-program-move col-xs-3"
                                         draggable="true">
                                        <span class="fa fa-arrows fa-2x track-program-move-icon"
                                              title="Move"/>
                                    </div>

                                    <div class="event-track-program-schedule col-xs-3">
                                        <span class="fa fa-calendar fa-2x track-program-schedule-icon"
                                              title="Schedule"
                                              data-toggle="modal"
                                              data-target="#track-schedule-action"
                                              data-action="schedule"
                                              t-attf-data-track="#{track.id}"
                                        />
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="track-td-name col-xs-12">
                                        <span t-esc="track and track.name"/>
                                    </div>
                                    <div class="col-xs-12">
                                        <span t-esc="track.duration"
                                              t-options='{"widget": "duration", "unit": "hour", "round": "minute"}'/>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </t>
                </tr>
            </table>
        </div>

        <t t-call="website_event_track_agenda_editor.track_schedule_dialog" />

        <script type="text/javascript"
                src="/website_event_track_agenda_editor/static/src/js/agenda-editor.js?v100"></script>
    </template>

    <!-- Track schedule template -->
    <template id="website_event_track_agenda_editor.track_schedule_dialog" name="Schedule dialog for track">
        <div class="modal fade track-schedule-action" id="track-schedule-action" tabindex="-1" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form class="form-horizontal" method="post" action="/event/track/schedule/">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        <input type="hidden" name="track_id" id="track_id"/>
                        <div class="modal-header">
                            <h3>Schedule</h3>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="control-label" for="date">Date</label>
                                <input required="1" class="form-control" type="date" name="date" />
                            </div>
                            <div class="form-group">
                                <label class="control-label" for="time">Time</label>
                                <input required="1" class="form-control" type="time" name="time" step="60"  />
                            </div>
                            <div class="form-group">
                                <label class="control-label" for="location_id">Location</label>
                                <select required="1" class="form-control" name="location_id" id="location-id">
                                    <option></option>
                                    <t t-foreach="request.env['event.track.location'].search([('show_in_agenda', '=', True)])" t-as="location">
                                        <option t-att-value="location.id"><span t-field="location.name"/></option>
                                    </t>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-success btn-ok">Schedule</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </template>

</odoo>
