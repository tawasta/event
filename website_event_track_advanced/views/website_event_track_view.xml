<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Overwrites the track view layout -->
    <template id="website_event_track.track_view">
        <t t-call="website_event_track_advanced.track_view"/>
    </template>

    <!-- Single track item -->
    <template id="website_event_track_advanced.track_view">
        <t t-call="website.layout">
            <div id="wrap" class="js_event">
                <div class="container">
                    <div class="row mt8">
                        <div class="col-sm-7" id="event_menu">
                            <ol name="Event Menu" class="breadcrumb mb0"
                                id="event_menu" t-if="event.menu_id"
                                t-att-data-content_menu_id="editable and event.menu_id.id">
                                <t t-foreach="event.menu_id.child_id"
                                   t-as="submenu">
                                    <t t-call="website.submenu"/>
                                </t>
                            </ol>
                        </div>
                        <t t-call="website.publish_management">
                            <t t-set="object" t-value="track"/>
                            <t t-set="publish_edit" t-value="True"/>
                            <t t-set="action"
                               t-value="'website_event_track.action_event_track'"/>
                        </t>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="clearfix"/>
                <h2 t-field="track.name" class="text-center"/>

                <h3 t-field="event.name" class="text-center text-muted"/>

                <t t-call="website_event_track_advanced.presentation_header_info" />

                <ul t-if="track.tag_ids"
                    class="text-center text-muted list-inline">
                    <li t-foreach="track.tag_ids" t-as="tag_id">
                        <span class="fa fa-tags"></span>
                        <a t-attf-href="/event/#{ slug(event) }/track/tag/#{ slug(tag_id) }">
                            <span t-field="tag_id.name"/>
                        </a>
                    </li>
                </ul>

                <div class="row">
                    <a class="btn btn-link pull-left" t-attf-href="/event/#{ slug(event) }/agenda">
                        <span class="fa fa-chevron-left" /> Back to agenda</a>
                </div>

                <section class="row mt32">
                    <div class="col-md-8 mb32" id="left_column">
                        <t t-call="website_event_track_advanced.track_form_description" />
                    </div>

                    <div class="col-md-4" id="right_column">

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4>Practical Info</h4>
                            </div>
                            <div class="panel-body">
                                <div t-if="track.date">
                                    <strong>Starts</strong><br/>
                                    <span t-field="track.date"
                                          t-options='{"hide_seconds":"True"}'/><br/>
                                </div>
                                <div t-if="track.date_end">
                                    <strong>Ends</strong><br/>
                                    <span t-field="track.date_end"
                                          t-options='{"hide_seconds":"True"}'/><br/>
                                </div>

                                <div t-if="track.duration">
                                    <strong>Duration</strong><br/>
                                    <span t-field="track.duration"
                                          t-options='{"widget": "duration", "unit": "hour", "round": "minute"}'/><br/>
                                </div>

                                <div t-if="track.location_id">
                                    <strong>Location</strong><br/>
                                    <span t-field="track.location_id"/><br/>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default" t-if="track.target_group or track.chairperson_id">
                            <div class="panel-heading">
                                <h4>Presentation Info</h4>
                            </div>
                            <div class="panel-body">
                                <div t-if="track.chairperson_id">
                                    <p>
                                        <strong>Chairperson</strong><br/>
                                        <span t-field="track.chairperson_id" />
                                    </p>
                                </div>

                                <div t-if="track.target_group">
                                    <p>
                                        <strong>Target group</strong><br/>
                                        <span t-field="track.target_group" />
                                    </p>
                                </div>

                                <div t-if="track.target_group_info and track.target_group">
                                    <p>
                                        <strong>Target group info</strong><br/>
                                        <span t-field="track.target_group_info" />
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default" t-if="track.speaker_ids">
                            <div class="panel-heading">
                                <h4>Presenters</h4>
                            </div>

                            <div class="panel-body">
                                <div t-foreach="track.speaker_ids"
                                     t-as="speaker" class="">

                                    <p class="font-weight-bold" t-field="speaker.name" />
                                    <p t-if="speaker.parent_id" class="text-muted" t-field="speaker.parent_id.name" />
                                    <p t-if="speaker.function" class="text-muted" t-field="speaker.function" />
                                    <p t-if="speaker.website" class="text-muted">
                                        <a t-att-href="speaker.website" target="_blank"><span t-field="speaker.website" /></a>
                                    </p>

                                    <hr t-if="not speaker_last" />
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </t>

        <script type="text/javascript" src="/website_event_track_advanced/static/src/js/track_view.js?v100"></script>
    </template>

   <template id="presentation_list">
        <t t-call="website_event.event_details">
            <div class="oe_structure"/>

            <t t-call="presentation_list_content" />

            <div class="oe_structure"/>
        </t>
    </template>

    <template id="presentation_list_content">
        <a class="btn btn-link pull-left" t-attf-href="/event/#{ slug(event) }/agenda">
            <span class="fa fa-chevron-left" /> Back to agenda</a>

        <div class="col-md-12">

        <div class="alert alert-warning" t-if="not len(tracks)">
            No presentations found!
        </div>

        <div class="col-sm-10 col-sm-offset-1 mb8">
            <p t-if="tag_id" class="text-muted fa fa-tags mt8">
                <span t-field="tag_id.name"/>
            </p>

            <a t-if="tag_id"
               class="btn btn-primary pull-right"
               t-attf-href="/event/#{ slug(event) }/presentation/">Show all</a>
        </div>

        <div name="track-row" class="row mb8" t-foreach="tracks" t-as="track">
            <t t-call="website_event_track_advanced.presentation_list_item" />
        </div>
    </div>
    </template>

    <!-- Single presentation item in list view -->
    <template id="presentation_list_item">
        <div class="col-sm-10 col-sm-offset-1 presentation-list-item well">
            <div>
                <strong>
                    <a t-attf-href="/event/#{ slug(event) }/track/#{ slug(track) }"><span t-field="track.name" /></a></strong>

                <small t-if="not track.website_published" class="label label-danger">unpublished</small>
            </div>
            <ul class="list-inline mb0 mt8">
                <li t-if="track.speaker_ids" class="text-muted fa fa-user">
                    <t t-esc="', '.join([speaker.name for speaker in track.speaker_ids])"></t>
                </li>

                <li t-if="track.date" class="text-muted fa fa-calendar"> <span t-field="track.date" t-options='{"hide_seconds":"True"}'/></li>

                <li class="text-muted fa fa-map-marker" t-if="track.location_id">
                    <span t-field="track.location_id"/>
                </li>
            </ul>

            <ul class="list-group list-unstyled mt8 col-md-6 col-sm-12">
                <li t-if="track.target_group" >
                    <strong>Target group:</strong> <span t-field="track.target_group" />
                </li>

                <li t-if="track.target_group_info" >
                    <span t-esc="html2plaintext(track.target_group_info or '')" />
                </li>
            </ul>

            <ul class="list-group list-unstyled mt8 col-md-6 col-sm-12">
                <li t-if="track.location_id">
                    <strong>Location:</strong> <span t-field="track.location_id.name" />
                </li>
                <li t-if="track.date">
                    <strong>Date:</strong> <span t-field="track.date" t-options='{"hide_seconds":"True"}'/>
                </li>
                <li t-if="track.duration">
                    <strong>Duration:</strong> <span t-field="track.duration" t-options='{"widget": "duration", "unit": "hour", "round": "minute"}'/>
                </li>
                <li t-if="track.language" >
                    <strong>Language:</strong> <span t-field="track.language" />
                </li>
            </ul>

            <ul class="list-group list-inline mt8 col-xs-12">
                <li t-foreach="track.tag_ids" t-as="tag_id" class="text-muted fa fa-tags">
                    <a t-attf-href="/event/#{ slug(event) }/presentation/tag/#{ slug(tag_id) }">
                        <span t-field="tag_id.name"/>
                    </a>
                </li>
            </ul>
            <div class="col-xs-12">
                <p>
                    <t t-esc="html2plaintext(track.description or '')[0:500]"/>
                    <t t-if="track.description">...</t>
                </p>
            </div>
        </div>
    </template>

    <!-- Presentation header info -->
    <template id="presentation_header_info">
        <ul class="text-center text-muted list-inline">
            <li t-if="track.speaker_ids" class="fa fa-user">
                <t t-esc="', '.join([speaker.name for speaker in track.speaker_ids])"></t>
            </li>

            <li t-if="track.date" class="text-muted fa fa-calendar"> <span t-field="track.date" t-options='{"hide_seconds":"True"}'/></li>

            <li class="text-muted fa fa-map-marker" t-if="track.location_id">
                <span t-field="track.location_id"/>
            </li>

            <li t-if="event.show_track_twitter_hashtags and track.type.attendable" class="text-muted fa fa-twitter">
                <a class="twitter-share-button twitter-link"
                   t-attf-href="https://twitter.com/intent/tweet?hashtags=#{track.twitter_hashtag}"
                   target="_blank"
                   title="Tweet about this presentation">#<span t-esc="track.twitter_hashtag" />
                </a>
            </li>
        </ul>
    </template>

    <template id="track_form_description" >
        <div class="panel panel-default" id="track-form-description">
            <div class="panel-heading">
                <h4>Description</h4>
            </div>
            <div class="panel-body">
                <div class="col-md-12 text-center" t-if="track.partner_name">
                    <small>
                        Proposed by
                        <span t-field="track.partner_name"/>
                    </small>
                </div>
                <div t-if="track.description" class="col-md-12">
                    <div t-field="track.description"/>
                </div>

                <div t-if="track.partner_biography"
                     class="col-md-12">
                    <h3>About The Author</h3>
                    <div t-field="track.partner_biography"/>
                </div>

                <div t-if="track.image_presentation" class="col-md-12 mt16">
                    <img t-if="track.image_presentation" class="track-image"
                             t-att-src="'/web/image?model=event.track&amp;field=image_presentation&amp;id='+str(track.id)"/>
                </div>

                <div class="col-md-12" t-if="track.attachment_ids">
                    <t t-foreach="track.attachment_ids" t-as="attachment">
                        <!-- File attachment and download -->
                        <div class="col-xs-12 col-md-4 text-center">
                            <a t-att-href="'/web/content/%s?download=1' % (attachment.id)">
                                <div class="o_image attachment-image" t-att-data-mimetype="'%s' % (attachment.mimetype)"></div>
                                <t t-esc="attachment.name"/>
                            </a>
                        </div>
                    </t>
                </div>

                <div t-if="track.extra_materials_plain" class="col-md-12 mt16">
                    <div t-field="track.extra_materials"/>
                </div>
            </div>
        </div>
    </template>

</odoo>
