<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record id="view_event_track_form" model="ir.ui.view">
        <field name="name">view_event_track_form_advanced</field>
        <field name="model">event.track</field>
        <field name="inherit_id" ref="website_event_track.view_event_track_form"/>
        <field name="arch" type="xml">

            <field name="partner_id" position="after">
                <field name="chairperson_id" />
                <field name="organizer"/>
                <field name="organizer_contact"/>
            </field>

            <!-- Hide extra fields from non-managers-->
            <xpath expr="//header" position="attributes">
                <attribute name="groups">event.group_event_manager</attribute>
            </xpath>

            <xpath expr="//sheet/group[1]" position="attributes">
                <attribute name="name">info_group</attribute>
                <attribute name="groups">event.group_event_manager</attribute>
            </xpath>

            <div name="button_box" position="attributes">
                <attribute name="groups">event.group_event_manager</attribute>
            </div>

            <label for="event_id" position="attributes">
                <attribute name="groups">event.group_event_manager</attribute>
            </label>

            <field name="event_id" position="attributes">
                <attribute name="groups">event.group_event_manager</attribute>
            </field>

            <xpath expr="//div[@class='oe_chatter']" position="attributes">
                <attribute name="name">chatter</attribute>
                <attribute name="groups">event.group_event_manager</attribute>
            </xpath>

            <field name="partner_name" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>

            <field name="partner_email" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>

            <field name="partner_phone" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>

            <!-- Replaces the group with speakers, location, date and tags information -->
            <!-- Add a "full" speaker_ids field without tags-widget -->
            <!-- Move date and duration to same place as end date and overlapping tracks -->
            <xpath expr="//sheet/group[last()]/group[last()]" position="replace">
                <group>
                    <field name="tag_ids" widget="many2many_tags"/>
                </group>
            </xpath>

            <xpath expr="//sheet/group[last()]" position="after">

                <group name='dates'>
                    <group>
                        <field name="date"/>
                        <label for="duration"/>
                        <div>
                            <field name="duration" class="oe_inline" widget="float_time"/>
                            hours
                        </div>
                        <field name="date_end"/>
                    </group>
                    <group>
                        <label for="show_in_agenda" colspan="2" attrs="{'invisible':[('show_in_agenda', '=', True)]}" string="Will not be shown in agenda!" />
                        <field name="show_in_agenda" invisible="1"/>
                        <field name="location_id"/>
                        <field name="type" domain="[('code', '!=', 'break')]" options="{'no_quick_create':True,'no_create_edit':True}"/>
                    </group>
                </group>

                <group name="speakers" string="Presenters">
                    <field name="speaker_ids" nolabel="1"/>
                </group>

                <group name="reviewer" groups="event.group_event_manager">
                    <group>
                        <field name="review_group"
                               groups="event.group_event_user"
                               options="{'no_quick_create':True,'no_create_edit':True}"
                        />
                    </group>
                    <group groups="event.group_track_reviewer">
                        <label for="rating"/>
                        <span>
                            <field name="rating" widget="priority" nolabel="1"/>
                            <field name="rating_comment" nolabel="1" placeholder="Verbal rating"/>
                        </span>
                    </group>
                </group>

                <notebook>
                    <page name="description" string="Content">
                        <group>
                            <field name="application_file_filename" invisible="1" />
                            <field name="application_file" widget="binary" filename="application_file_filename"/>
                        </group>
                        <group>
                            <field name="description" nolabel="1"/>
                        </group>
                    </page>
                    <page name="description_original" string="Original content">
                        <group>
                            <field name="description_original" nolabel="1"/>
                        </group>
                    </page>
                    <page name="extra_info" string="Extra info" groups="event.group_event_manager">
                        <group colspan="2">
                            <field name="extra_materials"/>
                            <field name="video_url"/>
                            <field name="external_registration"/>
                        </group>
                    </page>
                    <page name="target_group" string="Target group" groups="event.group_event_manager">
                        <group name="portal">
                            <group>
                                <field name="language" options="{'no_quick_create':True,'no_create_edit':True}"/>
                                <field name="target_group" options="{'no_quick_create':True,'no_create_edit':True}"/>
                            </group>

                            <group>

                            </group>

                            <group colspan="2">
                                <field name="target_group_info"/>
                                <field name="extra_info"/>
                            </group>
                        </group>
                    </page>
                    <page name="ratings" string="Ratings" groups="event.group_event_manager">
                        <field name="ratings" readonly="1" nolabel="1" colspan="2">
                            <tree>
                                <field name="create_uid"/>
                                <field name="create_date"/>
                                <field name="write_date"/>
                                <field name="rating" widget="priority" avg="Average"/>
                                <field name="comment"/>
                            </tree>
                        </field>
                    </page>
                    <page name="webinar" string="Webinar">
                        <group>
                            <field name="webinar"/>
                            <field name="webinar_info" attrs="{'readonly': [('webinar', '=', False)]}"/>
                        </group>
                    </page>
                    <page name="workshop"
                          string="Workshop"><!-- Won't work. We would need to use "type.code" attrs="{'invisible': [('type', '!=', 'workshop')]}"-->
                        <group cols="1">
                            <field name="workshop_participants" nolabel="0"/>
                            <field name="workshop_fee" nolabel="0"/>
                            <field name="workshop_goals" nolabel="0"/>
                            <field name="workshop_schedule" nolabel="0"/>
                        </group>
                    </page>
                    <page name="overlap" string="Overlapping presentations">
                        <group name="overlapping_tracks" col="1">
                            <field name="overlapping_location_track_ids"
                                   attrs="{'invisible':[('overlapping_location_track_ids', '=', [])]}">
                                <tree>
                                    <field name="name"/>
                                    <field name="location_id"/>
                                    <field name="date"/>
                                    <field name="date_end"/>
                                    <field name="duration" widget="float_time"/>
                                </tree>
                            </field>
                            <field name="overlapping_chairperson_track_ids"
                                   attrs="{'invisible':[('overlapping_chairperson_track_ids', '=', [])]}">
                                <tree>
                                    <field name="name"/>
                                    <field name="chairperson_id"/>
                                    <field name="date"/>
                                    <field name="date_end"/>
                                    <field name="duration" widget="float_time"/>
                                </tree>
                            </field>
                            <field name="overlapping_speaker_track_ids"
                                   attrs="{'invisible':[('overlapping_speaker_track_ids', '=', [])]}">
                                <tree>
                                    <field name="name"/>
                                    <field name="date"/>
                                    <field name="date_end"/>
                                    <field name="duration" widget="float_time"/>
                                </tree>
                            </field>
                        </group>
                    </page>
                </notebook>
            </xpath>

        </field>
    </record>

</odoo>