<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Overwrites the agenda layout -->
    <template id="website_event_track.agenda">
        <t t-call="website_event_track_advanced.agenda" />
    </template>

    <template id="website_event_track_advanced.agenda">
        <t t-call="website_event.layout">

            <section class="container">
                <h1 class="text-center" t-field="event.name" />
                <div class="form-inline">

                    <div id="filter-tracks" class="row mt16">
                        <!--
                        <div id="filter-track-tags" class="col-sm-9 col-xs-12">
                            <a id="tags-collapse-button"
                               class="btn btn-default text-muted"
                               data-toggle="collapse"
                               data-target="#tags-collapse">Show filters...</a>

                            <div id="tags-collapse" class="mt16 collapse">
                                <t t-foreach="event.allowed_track_tag_ids" t-as="tag_id">
                                    <a t-attf-href="/event/#{ slug(event) }/agenda/tag/#{ slug(tag_id) }"
                                       t-att-class="'btn btn-primary' if searches.get('tag') == tag_id.id else 'btn btn-default'"
                                       t-attf-value="#{tag_id.name}"
                                       t-attf-name="tag_#{tag_id.id}">
                                        <small>
                                            <span class="fa fa-tags" />
                                            <span t-field="tag_id.name"/> (<t t-esc="tag_id.track_count_agenda" />)
                                        </small>
                                    </a>
                                </t>
                            </div>
                        </div>
                        -->
                        <div id="filter-tracks-search" class="col-sm-3 col-xs-12">
                            <label class="hidden text-muted" id="event-track-search-summary"><span id="event-track-found">0</span> Found </label>
                            <input type="text" class="form-control" placeholder="Filter presentations..." id="event-track-search"/>

                            <!--
                            <br />
                            <a id="tags-clear-button" t-attf-href="/event/#{slug(event)}/agenda" class="btn btn-default text-danger">
                                <span class="fa fa-trash" />Clear filters
                            </a>
                            -->
                        </div>
                    </div>
                </div>
            </section>
            <t t-set="dayslist" t-value="days.keys()"/>
            <t t-set="dayslist2" t-value="dayslist.sort()"/>

            <section t-if="not dayslist" class="container mt16">
                <p>0 found.</p>
            </section>

            <section class="container container-wide mt16" t-foreach="dayslist" t-as="day">
                <t t-set="locations" t-value="days[day]['locations']"/>
                <t t-set="dates" t-value="days[day]['dates']"/>

                <t t-call="website_event_track_advanced.agenda_day_heading" />

                <t t-call="website_event_track_advanced.agenda_day_content" />
            </section>
        </t>

        <script type="text/javascript" src="/website_event_track_advanced/static/src/js/agenda.js?v102"></script>
    </template>

    <!-- Agenda td content -->
    <template id="agenda_track_td_content">

        <a name="event-track-link" t-attf-href="/event/#{ slug(event) }/track/#{ slug(track) }">

            <div style="height:100%;width:100%" class="event-track-content track-td-name" data-html="true" data-placement="bottom" data-toggle="tooltip">
                <div t-attf-class="{{ 'text-muted' if not track.type.attendable else '' }}">
                    <span t-esc="track and track.name"/>
                </div>

                <!-- Anything inside this div (extra-info) is shown only as a tooltip -->
                <div name="extra-info" t-if="track.type.attendable and track.speaker_ids" class="extra-info" style="display:none;">
                    <!-- Time -->
                    <div class="track-td-time mt8">
                        <i t-if="track.date" class="fa fa-clock-o"/>
                        <span t-field="track.date" t-options='{"hide_seconds":"True"}'/>,
                        <span t-field="track.duration" t-options='{"widget": "duration", "unit": "hour", "round": "minute"}'/>
                    </div>

                    <!-- Speakers -->
                    <div name="track-td-speakers" class="track-td-speakers mt8">
                        <i t-if="speakers[track.id]" class="fa fa-comment"/>
                        <span t-esc="speakers[track.id]"/>
                    </div>

                    <!-- Target group -->
                    <div name="track-td-targetgroup" class="track-td-targetgroup mt8">
                        <i t-if="track.target_group" class="fa fa-dot-circle-o"/>
                        <span t-esc="track.target_group.name"/>
                    </div>

                    <!-- Track tags -->
                    <div name="track-td-tags" class="track-td-tags mt8">
                        <i t-if="tags[track.id]" class="fa fa-tag"/>
                        <span t-esc="tags[track.id]"/>
                    </div>
                </div>
            </div>
        </a>
    </template>

    <!--Agenda date heading -->
    <template id="agenda_day_heading">
        <h3 class="date-heading page-header mt0">
            <t t-esc="dateparser.parse(day).strftime('%d.%m.%Y')"/>
            <small>
                <t t-esc="days_nbr[day]"/>
                talks
            </small>

            <span class="fa fa-chevron-down chevron-toggle" style="display: none;"/>
            <span class="fa fa-chevron-up chevron-toggle" />
        </h3>
    </template>

    <!--Agenda date content -->
    <template id="agenda_day_content">
        <div class="agenda-day-content">
            <table class="table table-bordered table-condensed">
                <tr class="agenda-locations-row">
                    <th/>
                    <t t-foreach="locations.keys()" t-as="location">
                        <th t-if="location" class="active">
                            <span t-esc="location and location.name or 'Unknown'"/>
                        </th>
                    </t>
                </tr>
                <tr t-foreach="dates" t-as="dt" class="agenda-timeslot-row">
                    <td class="active agenda-timeslot-time">
                        <span t-esc="dt[0].strftime('%H:%M')"/> - <span t-esc="dt[3].strftime('%H:%M')"/>
                    </td>
                    <t t-if="dt[2]"> <!-- Not a multi location -->
                        <t t-foreach="locations" t-as="location">
                            <t t-if="location and dt[1].get(location, False)">
                                <t t-set="track" t-value="dt[1][location][0]"/>
                                <t t-if="track">
                                    <td t-att-rowspan="dt[1][location][3]"
                                        t-attf-class="event_color_#{track.color} #{track and 'event_track' or ''}"
                                        t-attf-name="track_#{track.id}"
                                        t-att-draggable="'1' if user.has_group('event.group_event_manager') else 0">
                                        <t t-if="track">
                                            <t t-call="website_event_track_advanced.agenda_track_td_content" />
                                        </t>
                                    </td>
                                </t>
                                <td t-if="not track" t-att-rowspan="dt[1][location][3]" class="event_track text-muted">
                                    <div class="track-td-name">
                                        Break
                                    </div>
                                </td>
                            </t>
                        </t>
                    </t>
                    <t t-if="not dt[2]">
                        <t t-set="track" t-value="dt[1][False][0]"/>
                        <td t-att-colspan="len(locations)"
                            t-attf-class="text-center event_color_#{track.color} #{track and 'event_track' or ''}"
                            t-attf-name="track_#{track.id}"
                            t-att-draggable="'1' if user.has_group('event.group_event_manager') else 0">
                            <t t-call="website_event_track_advanced.agenda_track_td_content" />
                        </td>
                    </t>
                </tr>
            </table>
        </div>
    </template>

</odoo>
