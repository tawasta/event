<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template name="Event track proposal" id="event_track_proposal" inherit_id="website_event_track.event_track_proposal">
        <xpath expr="//form/div[last() - 1]" position="after">
            <div class="form-group">
                <label class="col-md-3 col-sm-4 control-label" for="email_from">Attachments</label>
                <div class="col-md-7 col-sm-8">
                    <input type="file" class="o_website_form_input" name="attachment_ids" id="attachment_ids" multiple="1"/>
                </div>
            </div>
        </xpath>
    </template>

    <!-- Overwrites the agenda layout -->
    <template id="website_event_track.agenda">
        <t t-call="website_event.layout">
            <section class="container">
                <h1 class="text-center" t-field="event.name"/>
                <div class="form-inline pull-right">
                    <label class="invisible text-muted" id="search_summary"><span id="search_number">0</span> Found </label>
                    <input type="text" class="form-control" placeholder="Filter Tracks..." id="event_track_search"/>
                </div>
            </section>
            <t t-set="dayslist" t-value="days.keys()"/>
            <t t-set="dayslist2" t-value="dayslist.sort()"/> <!-- display days in the right order -->
            <section class="container" t-foreach="dayslist" t-as="day">
                <t t-set="locations" t-value="days[day]['locations']"/>
                <t t-set="dates" t-value="days[day]['dates']"/>
                <h3 class="page-header mt0">
                    <t t-esc="day"/>
                    <small><t t-esc="days_nbr[day]"/> talks</small>
                </h3>
                <table id="table_search" class="table table-bordered table-condensed">
                <tr>
                    <th/>
                    <t t-foreach="locations.keys()" t-as="location">
                        <th t-if="location" class="active">
                            <span t-esc="location and location.name or 'Unknown'"/>
                        </th>
                    </t>
                </tr>
                <tr t-foreach="dates" t-as="dt">
                    <td class="active">
                        <b t-esc="dt[0].strftime('%H:%M')"/>
                    </td>
                    <t t-if="dt[2]"> <!-- Not a multi location -->
                        <t t-foreach="locations" t-as="location">
                            <t t-if="location and dt[1].get(location, False)">
                                <t t-set="track" t-value="dt[1][location][0]"/>
                                <t t-if="track">
                                    <td t-att-rowspan="dt[1][location][3]" t-attf-class="event_color_#{track.color} #{track and 'event_track' or ''}">
                                        <t t-if="track">
                                            <a t-attf-href="/event/#{ slug(event) }/track/#{ slug(track) }">
                                                <span t-esc="track and track.name"/>
                                            </a>
                                            <div class="text-muted">
                                                <small t-esc="speakers[track.id]"/>
                                            </div>
                                        </t>
                                    </td>
                                </t>
                                <td t-if="not track" t-att-rowspan="dt[1][location][3]" class="event_track"/>
                            </t>
                        </t>
                    </t><t t-if="not dt[2]">
                        <t t-set="track" t-value="dt[1][False][0]"/>
                        <td t-att-colspan="len(locations)-1" t-attf-class="text-center event_color_#{track.color} #{track and 'event_track' or ''}">
                            <a t-attf-href="/event/#{ slug(event) }/track/#{ slug(track) }">
                                <span t-esc="track.name"/>
                            </a>
                            <div class="text-muted">
                                <small t-esc="speakers[track.id]"/>
                            </div>
                        </td>
                    </t>
                </tr>
                </table>
            </section>
        </t>
    </template>

</odoo>
