<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="event_track_proposal_advanced" inherit_id="website_event_track.event_track_proposal">
        <xpath expr="//div[@t-if='not track']" position="replace">
            <div t-if="not track_submitted">
                <div t-if="event.website_track_proposal or request.env.user.has_group('event.group_event_manager')">
                    <section class="mt-5">
                        <t t-if="tracks">
                            <h3 class="o_page_header">Applications</h3>
                            <p>
                            Manage existing proposals or propose a new talk
                            </p>
                        </t>
                        <t t-else="">
                            <h3 class="o_page_header">Application</h3>
                            <p>
                                Fill this form to propose your talk.
                            </p>
                        </t>
                    </section>
                    <div class="row">
                        <t t-foreach="tracks" t-as="track">
                            <t t-call="website_event_track_advanced.event_track_proposal_template"/>
                        </t>
                    </div>
                    <t t-set="track" t-value="request.env['event.track']"/>
                    <t t-call="website_event_track_advanced.event_track_proposal_template_new"/>
                </div>
            </div>
        </xpath>
    </template>
    <template id="event_track_proposal_template_new" name="Event Track New Application">
        <div>
            <form id="track_proposal" class="mb-5" t-attf-action="/event/#{slug(event)}/track_proposal/form" method="post" itemscope="itemscope" itemprop="offers" itemtype="http://schema.org/AggregateOffer">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <input type="hidden" name="track_id" t-att-value="track.id"/>
                <button type="submit" class="btn btn-primary o_wait_lazy_js btn-block a-submit" t-attf-id="#{track.id}">New Proposal</button>
            </form>
        </div>
    </template>
    <template id="event_track_proposal_template" name="Event Track Application">
        <div class="col-xl-6">
            <form id="track_proposal" class="mb-5" t-attf-action="/event/#{slug(event)}/track_proposal/form" method="post" itemscope="itemscope" itemprop="offers" itemtype="http://schema.org/AggregateOffer">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <input type="hidden" name="track_id" t-att-value="track.id"/>
                <div t-attf-class="card border border-primary">
                    <div class="card-body" style="min-height: 130px;">
                        <button type="submit" class="btn btn-link a-submit float-right p-0 no-decoration o_wait_lazy_js" role="button" title="Edit this proposal" aria-label="Edit this proposal" t-attf-id="#{track.id}">
                            <i class="fa fa-edit"/>
                        </button>
                        <div class="mb-0">
                            <div>
                                <span>
                                    <t t-esc="track.name"/>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </template>
    <!-- Warning modal -->
    <template name="Event Track Warning" id="event_track_warning">
        <div id="modal_event_track_warning" class="modal fade" tabindex="-1" role="dialog" data-backdrop="false">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header align-items-center">
                        <h4 class="modal-title">Close Proposal</h4>
                        <button type="button" class="close cancelclosed" aria-label="Close">
                            <span>×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <strong>Unsaved changes will be lost if you leave the page, are you sure?</strong>
                    </div>
                    <div class="modal-footer border-0 justify-content-between">
                        <button type="button" class="btn btn-secondary cancelclosed">Cancel</button>
                        <button type="button" name="warning-confirm" class="btn btn-primary confirmclosed">Confirm</button>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <!-- Application -->
    <template name="Event Track Application" id="event_track_application">
        <div id="modal_event_track_application" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
                <form id="track-application-form" class="mt32 js_website_submit_form" t-attf-action="/event/#{event.id}/track_proposal/post" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token(time_limit=False)"/>
                    <div class="modal-content">
                        <div class="modal-header align-items-center">
                            <h4 class="modal-title">Proposal</h4>
                            <button type="button" class="close closefirstmodal" aria-label="Close">
                                <span>×</span>
                            </button>
                        </div>
                        <div class="modal-body bg-light border-bottom">
                            <t t-call="website_event_track_advanced.event_track_application_type"/>
                            <t t-call="website_event_track_advanced.event_track_application_info"/>
                            <t t-call="website_event_track_advanced.event_track_application_targetgroup_info"/>
                            <t t-call="website_event_track_advanced.event_track_application_contact_info"/>
                            <t t-call="website_event_track_advanced.event_track_application_speakers"/>
                            <!-- <t t-call="website_event_track_advanced.event_track_application_webinar"/> -->
                            <!-- <t t-call="website_event_track_advanced.event_track_application_workshop"/> -->
                            <!-- <t t-call="website_event_track_advanced.event_track_application_extra_info"/> -->
                        </div>
                        <div class="modal-body bg-light border-bottom">
                            <p class="alert alert-info alert-dismissable">
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                                <i class="fa fa-info-circle"/>
                                <span>By clicking <strong>"Save as draft"</strong> the proposal shall be saved and can be edited later.</span>
                            </p>
                            <p class="alert alert-info alert-dismissable">
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                                <i class="fa fa-info-circle"/>
                                <span>By clicking <strong>"Save and submit"</strong> the proposal shall be saved and submitted for review.</span>
                                <br/>
                                <span>Please note that a completed proposal can no longer be edited.</span>
                            </p>
                        </div>
                        <div class="modal-footer border-0 justify-content-between">
                            <button type="button" class="btn btn-secondary closefirstmodal">Cancel</button>
                            <button t-if="not track or track.stage_id.is_editable" type="submit" name="track-save" value="track-save" id="application-submit-button" class="btn btn-primary">Save as draft</button>
                            <button t-if="not track or track.stage_id.is_editable" type="submit" name="track-confirm" value="track-confirm" id="application-submit-button-send" class="btn btn-primary">Save and submit</button>
                        </div>
                    </div>
                </form>
            </div>
            <t t-call="website_event_track_advanced.event_track_warning"/>
        </div>
    </template>
    <!-- Application type -->
    <template id="event_track_application_type">
        <div class="panel panel-primary" id="track-application-type-div">
            <div class="panel-heading">
                <h3 class="panel-title">Application type</h3>
            </div>
            <div class="panel-body">
                <div class="row" id="track-application-application-type-div">
                    <div class="form-group col-xl-6">
                        <label class="col-form-label" for="type">Application type</label>
                        <select name="type" class="form-control" required="This field is required">
                            <option value="">select...</option>
                            <t t-foreach="event.track_types_ids or []" t-as="application_type">
                                <option t-att-value="application_type.id" t-att-selected="application_type.id == track.type.id" t-att-data-description="application_type.description">
                                    <t t-esc="application_type.name"/>
                                </option>
                            </t>
                        </select>
                    </div>
                    <div class="form-group col-xl-6">
                        <label for="type_description" class="control-label">Description</label>
                        <span id="application_type_description" name="type_description"/>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <!-- Application info -->
    <template id="event_track_application_info">
        <div class="panel panel-primary" id="track-application-application-div">
            <div class="panel-heading">
                <h3 class="panel-title">Application info</h3>
            </div>
            <div class="panel-body">
                <p id="track-application-application-alert-info" class="alert alert-info alert-dismissable"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    This part of the application is disclosed to the reviewers.
                </p>
                <p id="track-application-application-alert-warning" class="alert alert-warning alert-dismissable"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    Avoid using identifiable information (name, organisation, project).
                </p>
                <div class="row" id="track-application-application-info-div">
                    <div class="form-group col-xl-6">
                        <label for="name" class="col-form-label">Presentation title</label>
                        <input name="name" maxlength="100" placeholder="Application Title" t-att-value="track.name" required="This field is required" class="form-control" type="text"/>
                    </div>
                    <div class="form-group col-xl-6">
                        <label for="video_url" class="col-form-label label-optional">Presentation in video format (link to e.g. YouTube)</label>
                        <input name="video_url" placeholder="https://www.youtube.com, ..." t-att-value="track.video_url" class="form-control" type="text"/>
                    </div>
                    <div class="form-group col-xl-12">
                        <label for="description" class="col-form-label">Content of the presentation</label>
                        <br/>
                        <textarea name="description" placeholder="Application content..." t-att-value="track.description" class="form-control" required="This field is required" rows="8" style="width: 100%; max-width: 100%;"/>
                    </div>
                    <div class="form-group col-xl-6">
                        <label class="col-form-label" for="language">Language of the presentation</label>
                        <select name="language" t-attf-class="form-control" required="This field is required">
                            <option value="">select...</option>
                            <t t-foreach="track_languages or []" t-as="language">
                                <option t-att-value="language.id" t-att-selected="language.id == track.language.id">
                                    <t t-esc="language.name"/>
                                </option>
                            </t>
                        </select>
                    </div>
                    <div class="form-group col-xl-6">
                        <label class="col-form-label label-optional" for="attachment_ids">Add attachments (optional)</label>
                        <input type="file" name="attachment_ids" t-att-value="track.attachment_ids" class="form-control-file" multiple="true"/>
                        <button type="button" id="btn-remove-attachment" class="btn btn-default" title="Remove attachments">
                            <i class="fa fa-trash"/>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <!-- Target group info -->
    <template id="event_track_application_targetgroup_info">
        <div class="panel panel-primary" id="track-application-targetgroup-div">
            <div class="panel-heading">
                <h3 class="panel-title">Target group details</h3>
            </div>
            <div class="panel-body">
                <p id="track-application-targetgroup-alert-info" class="alert alert-info alert-dismissable">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    <span>Select your presentation’s primary target group.</span>
                    <br/>
                    <span>You can enter specifications of your presentation’s target group in the target group details.</span>
                </p>
                <div class="row" id="track-application-targetgroup-info-div">
                    <div class="form-group col-xl-12">
                        <label class="col-form-label" for="target_group">Target group</label>
                        <select name="target_group" class="form-control" required="This field is required">
                            <option value="">select...</option>
                            <t t-foreach="event.target_group_ids or []" t-as="target_group">
                                <option t-att-value="target_group.id" t-att-selected="target_group.id == track.target_group.id">
                                    <t t-esc="target_group.name"/>
                                </option>
                            </t>
                        </select>
                    </div>
                    <div class="form-group col-xl-12">
                        <label for="target_group_info" class="col-form-label label-optional">Target group details</label>
                        <br/>
                        <textarea name="target_group_info" placeholder="Target group info..." t-att-value="track.target_group_info" class="form-control" rows="8"/>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <template id="website_event_track_advanced.event_track_application_contact_info">
        <div class="panel panel-primary" id="track-application-contact-div">
            <div class="panel-heading">
                <h3 class="panel-title">Presentation’s contact person</h3>
            </div>
            <div class="panel-body">
                <p id="track-application-contact-alert-info" class="alert alert-info alert-dismissable"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    Please fill the contact persons information here.
                </p>
                <div id="track-application-contact-row-div" class="row">
                    <div class="form-group col-xl-4">
                        <label for="contact_first_name" class="col-form-label">First Name</label>
                        <input name="contact_first_name" placeholder="First Name" t-att-value="track.partner_id.firstname" required="This field is required" class="form-control" type="text"/>
                    </div>
                    <div class="form-group col-xl-4">
                        <label for="contact_last_name" class="col-form-label">Last Name</label>
                        <input name="contact_last_name" placeholder="Last Name" t-att-value="track.partner_id.lastname" required="This field is required" class="form-control" type="text"/>
                    </div>
                    <div class="form-group col-xl-4">
                        <label for="contact_email" class="col-form-label">Email</label>
                        <input name="contact_email" placeholder="Email" t-att-value="track.partner_id.email" required="This field is required" class="form-control" type="email"/>
                    </div>
                    <div class="form-group col-xl-4">
                        <label for="contact_phone" class="col-form-label label-optional">Phone</label>
                        <input name="contact_phone" placeholder="Phone" t-att-value="track.partner_id.phone" class="form-control" type="tel"/>
                    </div>
                    <div class="form-group col-xl-4">
                        <label for="contact_organization" class="col-form-label">Organization</label>
                        <input name="contact_organization" placeholder="Organization" t-att-value="track.partner_id.parent_id.name" required="This field is required" class="form-control" type="text"/>
                    </div>
                    <div class="form-group col-xl-4">
                        <label for="contact_title" class="col-form-label">Title</label>
                        <input name="contact_title" placeholder="Title" t-att-value="track.partner_id.function" required="This field is required" class="form-control" type="text"/>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <template id="website_event_track_advanced.event_track_application_speakers">
        <div class="panel panel-primary" id="track-application-speakers-div">
            <div class="panel-heading">
                <h3 class="panel-title">Presenters</h3>
            </div>
            <div class="panel-body">
                <p id="track-application-speakers-alert-info" class="alert alert-info alert-dismissable">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    <span class="alert-message">List the details of all presenters</span>
                </p>
                <t t-set="speaker_count" t-value="0"/>
                <t t-foreach="track.speaker_ids" t-as="speaker">
                    <div class="track-application-speakers-div-row-container">
                        <span class="text-muted">Speaker #<t t-esc="speaker_count + 1"/></span>
                        <button type="button" class="btn btn-remove-speaker" disabled="1">
                            <i class="fa fa-trash"/>
                        </button>
                        <div t-attf-id="track-application-speakers-row-div-#{speaker_count}" class="row">
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_firstname[#{speaker_count}]" class="col-form-label">First Name</label>
                                <input t-attf-name="speaker_firstname[#{speaker_count}]" placeholder="First Name" t-att-value="speaker.firstname" required="This field is required" class="form-control" type="text"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_lastname[#{speaker_count}]" class="col-form-label">Last Name</label>
                                <input t-attf-name="speaker_lastname[#{speaker_count}]" placeholder="Last Name" t-att-value="speaker.lastname" required="This field is required" class="form-control" type="text"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_email[#{speaker_count}]" class="col-form-label">Email</label>
                                <input t-attf-name="speaker_email[#{speaker_count}]" placeholder="Email" t-att-value="speaker.email" required="This field is required" class="form-control" type="email"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_phone[#{speaker_count}]" class="col-form-label label-optional">Phone</label>
                                <input t-attf-name="speaker_phone[#{speaker_count}]" placeholder="Phone" t-att-value="speaker.phone" class="form-control" type="tel"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_organization[#{speaker_count}]" class="col-form-label">Organization</label>
                                <input t-attf-name="speaker_organization[#{speaker_count}]" placeholder="Organization" t-att-value="speaker.parent_id.name" required="This field is required" class="form-control" type="text"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_title[#{speaker_count}]" class="col-form-label">Title</label>
                                <input t-attf-name="speaker_title[#{speaker_count}]" placeholder="Title" t-att-value="speaker.function" required="This field is required" class="form-control" type="text"/>
                            </div>
                        </div>
                        <t t-set="speaker_count" t-value="speaker_count + 1"/>
                    </div>
                </t>
                <t t-if="speaker_count == 0">
                    <div class="track-application-speakers-div-row-container">
                        <span class="text-muted">Speaker #<t t-esc="speaker_count + 1"/>:</span>
                        <div t-attf-id="track-application-speakers-row-div-#{speaker_count}" class="row">
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_firstname[#{speaker_count}]" class="col-form-label">First Name</label>
                                <input t-attf-name="speaker_firstname[#{speaker_count}]" placeholder="First Name" required="This field is required" class="form-control" type="text"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_lastname[#{speaker_count}]" class="col-form-label">Last Name</label>
                                <input t-attf-name="speaker_lastname[#{speaker_count}]" placeholder="Last Name" required="This field is required" class="form-control" type="text"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_email[#{speaker_count}]" class="col-form-label">Email</label>
                                <input t-attf-name="speaker_email[#{speaker_count}]" placeholder="Email" required="This field is required" class="form-control" type="email"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_phone[#{speaker_count}]" class="col-form-label label-optional">Phone</label>
                                <input t-attf-name="speaker_phone[#{speaker_count}]" placeholder="Phone" class="form-control" type="tel"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_organization[#{speaker_count}]" class="col-form-label">Organization</label>
                                <input t-attf-name="speaker_organization[#{speaker_count}]" placeholder="Organization" required="This field is required" class="form-control" type="text"/>
                            </div>
                            <div class="form-group col-xl-4">
                                <label t-attf-for="speaker_title[#{speaker_count}]" class="col-form-label">Title</label>
                                <input t-attf-name="speaker_title[#{speaker_count}]" placeholder="Title" required="This field is required" class="form-control" type="text"/>
                            </div>
                        </div>
                        <t t-set="speaker_count" t-value="speaker_count + 1"/>
                    </div>
                </t>
                <div class="form-group">
                    <button type="button" class="btn btn-primary" id="add_speaker">Add presenter <i class="fa fa-user"/>
                    </button>
                </div>
            </div>
        </div>
    </template>
</odoo>
