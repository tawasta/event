<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="event_track_proposal_advanced" inherit_id="website_event_track.event_track_proposal">
        <xpath expr="//div[@t-if='not track']" position="replace">
            <div t-if="not track_submitted">
                <div t-if="event.website_track_proposal or request.env.user.has_group('event.group_event_manager')">
                    <section class="mt-5">
                        <t t-if="tracks">
                            <h3 class="o_page_header">Applications</h3>
                            <p>
                            Manage existing proposals or propose a new talk
                            </p>
                        </t>
                        <t t-else="">
                            <h3 class="o_page_header">Application</h3>
                            <p>
                                Fill this form to propose your talk.
                            </p>
                        </t>
                    </section>
                    <div class="row">
                        <t t-foreach="tracks" t-as="track">
                            <t t-call="website_event_track_advanced.event_track_proposal_template"/>
                        </t>
                    </div>
                    <t t-set="track" t-value="request.env['event.track']"/>
                    <t t-call="website_event_track_advanced.event_track_proposal_template_new"/>
                </div>
            </div>
        </xpath>
    </template>
    <template id="event_track_proposal_template_new" name="Event Track New Application">
        <div>
            <form id="track_proposal" class="mb-5" t-attf-action="/event/#{slug(event)}/track_proposal/form" method="post" itemscope="itemscope" itemprop="offers" itemtype="http://schema.org/AggregateOffer">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <input type="hidden" name="track_id" t-att-value="track.id"/>
                <button type="submit" class="btn btn-primary o_wait_lazy_js btn-block a-submit" t-attf-id="#{track.id}">
                            New Proposal
                        </button>
            </form>
        </div>
    </template>
    <template id="event_track_proposal_template" name="Event Track Application">
        <div class="col-xl-6">
            <form id="track_proposal" class="mb-5" t-attf-action="/event/#{slug(event)}/track_proposal/form" method="post" itemscope="itemscope" itemprop="offers" itemtype="http://schema.org/AggregateOffer">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <input type="hidden" name="track_id" t-att-value="track.id"/>
                <div t-attf-class="card border border-primary">
                    <div class="card-body" style="min-height: 130px;">
                        <button type="submit" class="btn btn-link a-submit float-right p-0 no-decoration o_wait_lazy_js" role="button" title="Edit this proposal" aria-label="Edit this proposal" t-attf-id="#{track.id}">
                            <i class="fa fa-edit"/>
                        </button>
                        <div class="mb-0">
                            <div>
                                <span>
                                    <t t-esc="track.name"/>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </template>
    <!-- Application -->
    <template name="Event Track Application" id="event_track_application">
        <div id="modal_event_track_application" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
                <form id="track-application-form" class="mt32 js_website_submit_form" t-attf-action="/event/#{event.id}/track_proposal/post" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token(time_limit=False)"/>
                    <div class="modal-content">
                        <div class="modal-header align-items-center">
                            <h4 class="modal-title">Proposal</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span>×</span>
                            </button>
                        </div>
                        <div class="modal-body bg-light border-bottom">
                            <t t-call="website_event_track_advanced.event_track_application_type"/>
                            <t t-call="website_event_track_advanced.event_track_application_info"/>
                            <t t-call="website_event_track_advanced.event_track_application_targetgroup_info"/>
                            <!-- <t t-call="website_event_track_advanced.event_track_application_contact_info"/> -->
                            <!-- <t t-call="website_event_track_advanced.event_track_application_speakers"/> -->
                            <!-- <t t-call="website_event_track_advanced.event_track_application_webinar"/> -->
                            <!-- <t t-call="website_event_track_advanced.event_track_application_workshop"/> -->
                            <!-- <t t-call="website_event_track_advanced.event_track_application_extra_info"/> -->
                        </div>
                        <div class="modal-body bg-light border-bottom">
                            <p class="alert alert-info alert-dismissable">
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                                <i class="fa fa-info-circle"/>
                                <span>By clicking <strong>"Save as draft"</strong> the proposal shall be saved and can be edited later.</span>
                            </p>
                            <p class="alert alert-info alert-dismissable">
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                                <i class="fa fa-info-circle"/>
                                <span>By clicking <strong>"Save and submit"</strong> the proposal shall be saved and submitted for review.</span>
                                <br/>
                                <span>Please note that a completed proposal can no longer be edited.</span>
                            </p>
                        </div>
                        <div class="modal-footer border-0 justify-content-between">
                            <button type="button" class="btn btn-secondary js_goto_event" data-dismiss="modal">Cancel</button>
                            <button t-if="not track or track.stage_id.is_editable" type="submit" name="track-save" value="track-save" id="application-submit-button" class="btn btn-primary">Save as draft</button>
                            <button t-if="not track or track.stage_id.is_editable" type="submit" name="track-confirm" value="track-confirm" id="application-submit-button-send" class="btn btn-primary">Save and submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </template>
    <!-- Application type -->
    <template id="event_track_application_type">
        <div class="panel panel-primary" id="track-application-type-div">
            <div class="panel-heading">
                <h3 class="panel-title">Application type</h3>
            </div>
            <div class="panel-body">
                <div class="row" id="track-application-application-type-div">
                    <div t-attf-class="form-group col-xl-6">
                        <label class="col-form-label" for="type">Application type</label>
                        <select name="type" t-attf-class="form-control" required="This field is required">
                            <option value="">select...</option>
                            <t t-foreach="event.track_types_ids or []" t-as="application_type">
                                <option t-att-value="application_type.id" style="display:none;" t-att-selected="application_type.id == track.type.id" t-att-data-description="application_type.description">
                                    <t t-esc="application_type.name"/>
                                </option>
                            </t>
                        </select>
                    </div>
                    <div class="form-group col-xl-6">
                        <label for="type_description" class="control-label">Description</label>
                        <span id="application_type_description" name="type_description"/>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <!-- Application info -->
    <template id="event_track_application_info">
        <div class="panel panel-primary" id="track-application-application-div">
            <div class="panel-heading">
                <h3 class="panel-title">Application info</h3>
            </div>
            <div class="panel-body">
                <p id="track-application-application-alert-info" class="alert alert-info alert-dismissable"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    This part of the application is disclosed to the reviewers.
                </p>
                <p id="track-application-application-alert-warning" class="alert alert-warning alert-dismissable"><a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    Avoid using identifiable information (name, organisation, project).
                </p>
                <div class="row" id="track-application-application-info-div">
                    <div class="form-group col-xl-6">
                        <label for="name" class="col-form-label">Presentation title</label>
                        <input name="name" maxlength="100" placeholder="Application Title" t-att-value="track.name" required="This field is required" t-attf-class="form-control" type="text"/>
                    </div>
                    <div class="form-group col-xl-6">
                        <label for="video_url" class="col-form-label label-optional">Presentation in video format (link to e.g. YouTube)</label>
                        <input name="video_url" placeholder="https://www.youtube.com, ..." t-att-value="track.video_url" t-attf-class="form-control" type="text"/>
                    </div>
                    <div class="form-group col-xl-12">
                        <label for="description" class="col-form-label">Content of the presentation</label>
                        <br/>
                        <textarea name="description" placeholder="Application content..." t-att-value="track.description" attf-class="form-control" required="This field is required" rows="8" style="width: 100%; max-width: 100%;"/>
                    </div>
                    <div t-attf-class="form-group col-xl-6">
                        <label class="col-form-label" for="language">Language of the presentation</label>
                        <select name="language" t-attf-class="form-control" required="This field is required">
                            <option value="">select...</option>
                            <t t-foreach="track_languages or []" t-as="language">
                                <option t-att-value="language.id" style="display:none;" t-att-selected="language.id == track.language.id">
                                    <t t-esc="language.name"/>
                                </option>
                            </t>
                        </select>
                    </div>
                    <div t-attf-class="form-group col-xl-6">
                        <label class="col-form-label label-optional" for="attachment_ids">Add attachments (optional)</label>
                        <input type="file" name="attachment_ids" t-att-value="track.attachment_ids" attf-class="form-control" multiple="true"/>
                        <button type="button" id="btn-remove-attachment" class="btn btn-default" title="Remove attachments">
                            <i class="fa fa-trash"/>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <!-- Target group info -->
    <template id="event_track_application_targetgroup_info">
        <div class="panel panel-primary" id="track-application-targetgroup-div">
            <div class="panel-heading">
                <h3 class="panel-title">Target group details</h3>
            </div>
            <div class="panel-body">
                <p id="track-application-targetgroup-alert-info" class="alert alert-info alert-dismissable">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    <span>Select your presentation’s primary target group.</span>
                    <br/>
                    <span>You can enter specifications of your presentation’s target group in the target group details.</span>
                </p>
                <div class="row" id="track-application-targetgroup-info-div">
                    <div t-attf-class="form-group col-xl-6">
                        <label class="col-form-label" for="target_group">Target group</label>
                        <select name="target_group" t-attf-class="form-control" required="This field is required">
                            <option value="">select...</option>
                            <t t-foreach="event.target_group_ids or []" t-as="target_group">
                                <option t-att-value="target_group.id" style="display:none;" t-att-selected="target_group.id == track.target_group.id">
                                    <t t-esc="target_group.name"/>
                                </option>
                            </t>
                        </select>
                    </div>
                    <div class="form-group col-xl-12">
                        <label for="target_group_info" class="col-form-label label-optional">Target group details</label>
                        <br/>
                        <textarea name="target_group_info" placeholder="Target group info..." t-att-value="track.target_group_info" attf-class="form-control" rows="8" style="width: 100%; max-width: 100%;"/>
                    </div>
                </div>
            </div>
        </div>
    </template>
</odoo>
