<odoo>

    <template id="portal_my_tracks" name="My Tracks">
        <t t-call="website_portal.portal_layout">
            <h3 class="page-header">Your tracks</h3>
            <t t-if="not tracks">
                <p>There are currently no tracks for your account.</p>
            </t>
            <t t-if="tracks">
                <div class="container list-group">
                    <div class="list-group-item row">
                        <div class="col-sm-2"><span class="tag label label-info">Draft</span></div>
                        <div class="col-sm-10">Created by you. Waiting for you to send this to review.</div>
                    </div>
                    <div class="list-group-item row">
                        <div class="col-sm-2"><span class="tag label label-warning">Confirmed</span></div>
                        <div class="col-sm-10">Confirmed by you. Waiting for an approval from reviewers.</div>
                    </div>
                    <div class="list-group-item row">
                        <div class="col-sm-2"><span class="tag label label-primary">Announced</span></div>
                        <div class="col-sm-10">Approved by reviewers. Waiting for your confirmation.</div>
                    </div>
                    <div class="list-group-item row">
                        <div class="col-sm-2"><span class="tag label label-success">Published</span></div>
                        <div class="col-sm-10">Confirmed by you. Included in the event program.</div>
                    </div>
                    <div class="list-group-item row">
                        <div class="col-sm-2"><span class="tag label label-danger">Refused</span></div>
                        <div class="col-sm-10">Not approved by reviewers.</div>
                    </div>
                    <div class="list-group-item row">
                        <div class="col-sm-2"><span class="tag label label-default">Cancelled</span></div>
                        <div class="col-sm-10">Cancelled by you.</div>
                    </div>
                </div>

                <table id="event_track_list" class="table table-hover o_my_status_table">
                    <thead>
                        <tr class="active">
                            <th>Track</th>
                            <th>Timeslot</th>
                            <th>State</th>
                            <th t-if="user.has_group('event.group_track_reviewer')">Review</th>
                            <th></th>
                        </tr>
                    </thead>
                    <t t-foreach="tracks" t-as="track">
                        <tr t-attf-data-href="/my/tracks/#{track.id}?#{keep_query()}">
                            <!-- Name -->
                            <td class="td-submit">
                                <a t-attf-href="/my/tracks/#{track.id}?#{keep_query()}">
                                    <t t-esc="track.name"/>
                                </a>
                            </td>

                            <!-- Date -->
                            <td class="td-submit">
                                <t t-if="track.date">
                                    <span t-field="track.date" t-options='{"widget": "datetime"}'/>
                                </t>
                                <t t-if="not track.date">
                                    -
                                </t>
                            </td>

                            <!-- State -->
                            <td class="td-submit">
                                <t t-set="track_state">label-default</t>

                                <t t-if="track.state == 'draft'">
                                    <t t-set="track_state">label-info</t>
                                </t>

                                <t t-if="track.state == 'confirmed'">
                                    <t t-set="track_state">label-warning</t>
                                </t>

                                <t t-if="track.state == 'announced'">
                                    <t t-set="track_state">label-primary</t>
                                </t>

                                <t t-if="track.state == 'published'">
                                    <t t-set="track_state">label-success</t>
                                </t>

                                <t t-if="track.state == 'refused'">
                                    <t t-set="track_state">label-danger</t>
                                </t>

                                <t t-if="track.state == 'cancel'">
                                    <t t-set="track_state">label-default</t>
                                </t>

                                <span t-field="track.state" t-attf-class="tag label {{track_state}}"/>
                            </td>

                            <!-- Action for presenter -->
                            <td t-if="user.partner_id.id != track.partner_id.id" />

                            <td t-if="user.partner_id.id == track.partner_id.id">
                                <!-- Confirm or cancel an approved track -->
                                <button t-if="track.state == 'draft'"
                                        class="btn btn-warning mb8"
                                        data-toggle="modal"
                                        data-target="#track-confirm-action"
                                        data-action="confirm"
                                        t-attf-data-title="#{track.name}"
                                        t-attf-data-href="/my/tracks/confirm/#{track.id}">Confirm</button>

                                <button t-if="track.state in ['draft']"
                                        class="btn btn-danger"
                                        data-toggle="modal"
                                        data-target="#track-confirm-action"
                                        data-action="cancel"
                                        t-attf-data-title="#{track.name}"
                                        t-attf-data-href="/my/tracks/cancel/#{track.id}">Cancel</button>

                                <!-- Approve or reject an approved track -->
                                <button t-if="track.state == 'announced'"
                                        class="btn btn-success mb8"
                                        data-toggle="modal"
                                        data-target="#track-confirm-action"
                                        data-action="approve"
                                        t-attf-data-title="#{track.name}"
                                        t-attf-data-href="/my/tracks/approve/#{track.id}">Approve</button>

                                <button t-if="track.state == 'announced'"
                                        class="btn btn-danger"
                                        data-toggle="modal"
                                        data-target="#track-confirm-action"
                                        data-action="reject"
                                        t-attf-data-title="#{track.name}"
                                        t-attf-data-href="/my/tracks/refuse/#{track.id}">Reject</button>

                                <!-- Re-open or reject an approved track -->
                                <button t-if="track.state == 'cancel'"
                                        class="btn btn-info"
                                        data-toggle="modal"
                                        data-target="#track-confirm-action"
                                        data-action="re-open"
                                        t-attf-data-title="#{track.name}"
                                        t-attf-data-href="/my/tracks/open/#{track.id}">Re-open</button>
                            </td>

                            <!-- Stars for reviewer -->
                            <td t-if="user.has_group('event.group_track_reviewer')">
                                <div class="input-group stars">
                                    <input disabled="1" class="star star-5" id="star-5" type="radio"
                                           t-att-checked="'checked' if track.rating == '5' else False" />
                                    <label class="star-small star-5" for="star-5"></label>
                                    <input disabled="1" class="star star-4" id="star-4" type="radio"
                                           t-att-checked="'checked' if track.rating == '4' else False" />
                                    <label class="star-small star-4" for="star-4"></label>
                                    <input disabled="1" class="star star-3" id="star-3" type="radio"
                                           t-att-checked="'checked' if track.rating == '3' else False" />
                                    <label class="star-small star-3" for="star-3"></label>
                                    <input disabled="1" class="star star-2" id="star-2" type="radio"
                                           t-att-checked="'checked' if track.rating == '2' else False" />
                                    <label class="star-small star-2" for="star-2"></label>
                                    <input disabled="1" class="star star-1" id="star-1" type="radio"
                                           t-att-checked="'checked' if track.rating == '1' else False" />
                                    <label class="star-small star-1" for="star-1"></label>
                                </div>
                            </td>

                            <!-- Comment for reviewer -->
                            <td t-if="user.has_group('event.group_track_reviewer')">
                                <span t-field="track.rating_comment" />
                            </td>
                        </tr>
                    </t>
                </table>
                <div t-if="pager" class="o_portal_pager text-center">
                    <t t-call="website.pager"/>
                </div>
            </t>
        </t>
        <t t-call="website_portal_track.confirm_dialog"/>
        <script type="text/javascript" src="/website_portal_track/static/src/js/event_track_list.js"></script>
    </template>

    <!-- Confirmation dialog template -->
    <template id="confirm_dialog" name="Confirmation dialog for track actions">
        <div class="modal fade" id="track-confirm-action" tabindex="-1" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Confirmation</h3>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to <strong><span class="modal-track-action" /></strong> proposal "<strong><span class="modal-track-title" />"</strong>?</p>
                    </div>
                    <div class="modal-footer">
                        <a class="btn btn-success btn-ok">Yes</a>
                        <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

</odoo>
